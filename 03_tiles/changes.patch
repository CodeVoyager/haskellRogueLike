Common subdirectories: ../01_web_ui/src/Data and ./src/Data
Only in ./src/: Entities.hs
Only in ./src/: EntityType.hs
diff -w -B -a -d -u -b ../01_web_ui/src/GameCore.hs ./src/GameCore.hs
--- ../01_web_ui/src/GameCore.hs	2018-02-18 15:37:50.223522344 +0200
+++ ./src/GameCore.hs	2018-02-18 15:37:39.082266617 +0200
@@ -14,7 +14,7 @@
 import           Control.Lens.TH (makeLenses)
 
 import qualified GameHost as Host
-
+import qualified EntityType as E
 
 data Player = Player { _plConn :: !Host.Connection
                      , _plScreenSize :: !(Int, Int)
@@ -27,31 +27,52 @@
 newtype Config = Config { _cfgKeys :: Map Text Text
                         }
 
+data Tile = Tile { _tlName :: !Text
+                 , _tlPic :: !(Int, Int)
+                 , _tlId :: !Int
+                 } deriving (Show, Eq, Ord)
+
+data Entity = Entity { _enType :: !E.EntityType
+                     , _enTile :: !Tile
+                     , _enProps :: !(Map Text Text)
+                     , _enAttribs :: !(Map Text Int)
+                     } deriving (Show, Eq, Ord)
+
+
 makeLenses ''World
 makeLenses ''Config
 makeLenses ''Player
+makeLenses ''Entity
+makeLenses ''Tile
 
 
-data UiMessage = UiMessage { umCmd :: Text
-                           , umMessage :: Text
+data UiMessage = UiMessage { umCmd :: !Text
+                           , umMessage :: !Text
                            }
                            deriving (Generic)
   
-data UiConfig = UiConfig { ucCmd :: Text
-                         , ucData :: UiConfigData
+data UiConfig = UiConfig { ucCmd :: !Text
+                         , ucData :: !UiConfigData
                          }
                          deriving (Generic)
 
-newtype UiConfigData = UiConfigData { udKeys :: [UiKey]
+data UiConfigData = UiConfigData { udKeys :: ![UiKey]
+                                 , udBlankId :: !Int
                                     }
                                     deriving (Generic)
 
-data UiKey = UiKey { ukShortcut :: Text
-                   , ukAction :: Text
+data UiKey = UiKey { ukShortcut :: !Text
+                   , ukAction :: !Text
                    }
                    deriving (Generic)
 
 
+data UiDrawCommand = UiDrawCommand
+                     { drCmd :: !Text
+                     , drScreenWidth :: !Int
+                     } deriving (Generic)
+
+
 instance Ae.ToJSON UiMessage where
   toJSON = Ae.genericToJSON Ae.defaultOptions { Ae.fieldLabelModifier = renField 2 True }
 
@@ -64,6 +85,9 @@
 instance Ae.ToJSON UiKey where
   toJSON = Ae.genericToJSON Ae.defaultOptions { Ae.fieldLabelModifier = renField 2 True }
 
+instance Ae.ToJSON UiDrawCommand where
+  toJSON = Ae.genericToJSON Ae.defaultOptions { Ae.fieldLabelModifier = renField 2 True }
+
 
 -- | drop prefix, and then lower case
 -- | renField 3 "tskBla" == "bla"
diff -w -B -a -d -u -b ../01_web_ui/src/GameEngine.hs ./src/GameEngine.hs
--- ../01_web_ui/src/GameEngine.hs	2018-02-18 10:10:42.961437918 +0200
+++ ./src/GameEngine.hs	2018-02-18 10:10:17.309202811 +0200
@@ -11,12 +11,15 @@
 import qualified Data.Aeson.Text.Extended as Ae
 import qualified Data.ByteString.Lazy as BSL
 import qualified Codec.Compression.BZip as Bz
-import           Control.Lens ((^.), (.~), (%~))
-import           Control.Concurrent.STM (atomically, newTVar, modifyTVar', TVar)
+import           Control.Lens (_1, (^.), (.~), (%~))
+import           Control.Concurrent.STM (atomically, readTVar, newTVar, modifyTVar', TVar)
 
 import           GameCore
 import qualified GameHost as Host
 import           GameHost (conSendData, conReceiveText)
+import qualified Entities as E
+import qualified EntityType as E
+
 
 runGame :: IO ()
 runGame = Host.runHost manageConnection
@@ -86,7 +89,9 @@
         Nothing -> sendError conn "missing / invalid screen size"
         Just (sx, sy) -> do
           updatePlayer (plScreenSize .~ (sx, sy))
-          sendLog conn $ "TODO: " <> cmd
+          w <- atomically $ readTVar worldV
+          drawAndSend w
+          sendLog conn "draw"
       
     "key" ->
       sendLog conn $ "TODO: " <> cmd <> ": " <> show cmdData
@@ -115,7 +120,9 @@
 
 buildConfig :: Config -> UiConfigData
 buildConfig cfg =
-  UiConfigData $ buildKeys (cfg ^. cfgKeys)
+  UiConfigData { udKeys = buildKeys (cfg ^. cfgKeys)
+               , udBlankId = E.getTile E.Blank ^. tlId
+               }
 
   where
     buildKeys ks = buildKey <$> Map.toList ks
@@ -139,4 +146,9 @@
   pure (x, y)
 
 
-  
+drawAndSend :: World -> IO ()
+drawAndSend world = do
+  let cmd = Ae.encodeText UiDrawCommand { drCmd = "draw"
+                                        , drScreenWidth = world ^. wdPlayer ^. plScreenSize ^. _1
+                                        }
+  sendData (world ^. wdPlayer ^. plConn) cmd
diff -w -B -a -d -u -b ../01_web_ui/src/GameHost.hs ./src/GameHost.hs
--- ../01_web_ui/src/GameHost.hs	2018-02-17 12:13:04.029016625 +0200
+++ ./src/GameHost.hs	2018-02-17 16:34:50.161448326 +0200
@@ -42,6 +42,9 @@
     Sc.get "/ping" $
       Sc.text "pong"
 
+    Sc.get "/tiles.png" $
+      Sc.file "html/DungeonCrawl_ProjectUtumnoTileset_0.png"
+
     Sc.get "/:res" $ do
       res <- Sc.param "res"
       Sc.file $ "html/" <> res
